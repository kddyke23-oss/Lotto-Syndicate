<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lotto Syndicate - Powerball Tracker</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ±</text></svg>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
body{margin:0;background:#020617;color:#f1f5f9;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
*{box-sizing:border-box}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}
@keyframes spin{to{transform:rotate(360deg)}}
.loader{width:32px;height:32px;border:3px solid #334155;border-top-color:#f59e0b;border-radius:50%;animation:spin .8s linear infinite}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useMemo,useEffect,useCallback}=React;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Password hashing â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHA-256 hash of the admin password. Change this to set a new password.
// To generate: open browser console, run:
//   crypto.subtle.digest('SHA-256',new TextEncoder().encode('YOUR_PASSWORD')).then(b=>console.log(Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join('')))
const ADMIN_HASH='a27596b5f7ed2baa18479205909c5f5104b02c5dbf548d59ceac349768a4c940';

async function checkPassword(input){
  const encoder=new TextEncoder();
  const data=encoder.encode(input);
  const hash=await crypto.subtle.digest('SHA-256',data);
  const hex=Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
  return hex===ADMIN_HASH;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Helpers â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const fmt=d=>{if(!d)return"â€”";return new Date(d+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})};
const fmtS=d=>{if(!d)return"â€”";return new Date(d+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})};
const isAct=(m,dt)=>m.join&&m.join<=dt&&(!m.exit||m.exit>dt);
const isEmpty=(dr)=>{const w=dr.w||dr.winning||[];return w[0]===0&&w[1]===0};
const getW=(dr)=>dr.w||dr.winning||[];
const getMatches=(mn,mp,dw,dp)=>{let c=0;for(const n of mn)if(dw.includes(n))c++;return{m:c,pb:mp===dp,sc:c+(mp===dp?10:0)}};
const checkWinTrigger=(members,date,winning,pb)=>{
  const active=members.filter(m=>isAct(m,date));
  const results=active.map(m=>{const r=getMatches(m.nums,m.pb,winning,pb);return{...m,...r}});
  const triggered=results.filter(r=>r.m>=3||r.pb);
  return{results,triggered,isWinner:triggered.length>0};
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SVG Icons â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ICONS={
  dash:'<rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>',
  mem:'<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>',
  drw:'<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="12" x2="16" y2="12"/>',
  mon:'<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>',
  pay:'<rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/>',
  pl:'<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>',
  x:'<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>',
  ed:'<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>',
  tr:'<path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>',
  cv:'<polyline points="6 9 12 15 18 9"/>',cu:'<polyline points="18 15 12 9 6 15"/>',
  ref:'<path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/>',
  lock:'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>',
  unlock:'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/>',
  dl:'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>',
  chart:'<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>',
  mail:'<path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>',
  copy:'<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>',
  gear:'<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>',
  check:'<polyline points="20 6 9 17 4 12"/>',
  gh:'<path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>',
};
function Ic({n,s=18}){return <svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" dangerouslySetInnerHTML={{__html:ICONS[n]||''}} />}
function Bl({number:num,isPb,isMatch,small}){
  const sz=small?"w-7 h-7 text-[11px]":"w-9 h-9 text-sm";
  const bg=isMatch?(isPb?"bg-amber-400 text-amber-950 ring-2 ring-amber-300":"bg-emerald-400 text-emerald-950 ring-2 ring-emerald-300"):(isPb?"bg-rose-500/20 text-rose-300 border border-rose-500/40":"bg-slate-700/60 text-slate-300 border border-slate-600/40");
  return <span className={`${sz} rounded-full inline-flex items-center justify-center font-bold font-mono ${bg}`}>{num}</span>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function App(){
  const[data,setData]=useState(null);
  const[error,setError]=useState(null);
  const[tab,setTab]=useState("dash");
  const[isAdmin,setIsAdmin]=useState(false);
  const[showLogin,setShowLogin]=useState(false);
  const[pwInput,setPwInput]=useState("");
  const[pwError,setPwError]=useState("");
  const[modal,setModal]=useState(null);
  const[lastRefresh,setLastRefresh]=useState(null);

  // GitHub connection settings (stored in localStorage)
  const[ghSettings,setGhSettings]=useState({user:'',repo:'',token:''});
  const[ghStatus,setGhStatus]=useState(null); // null | 'saving' | 'saved' | 'error'
  const[showGhSettings,setShowGhSettings]=useState(false);

  // Load GitHub settings from localStorage on mount
  useEffect(()=>{
    try{const s=localStorage.getItem('lotto_gh');if(s)setGhSettings(JSON.parse(s))}catch(e){}
  },[]);
  const saveGhSettings=(s)=>{setGhSettings(s);try{localStorage.setItem('lotto_gh',JSON.stringify(s))}catch(e){}};

  // Admin edits stored in memory (exported to JSON when done)
  const[editMembers,setEditMembers]=useState(null);
  const[editDraws,setEditDraws]=useState(null);
  const[editPeriods,setEditPeriods]=useState(null);
  const[editPayments,setEditPayments]=useState(null);

  // Embedded data fallback â€” used when data.json can't be fetched (Claude preview / local file)
  const EMBEDDED_DATA={"lastUpdated":"2026-02-13","members":[{"id":"A","name":"Keith and Lou Dyke","join":"2025-09-06","exit":null,"nums":[8,19,23,26,31],"pb":23,"qp":false},{"id":"B","name":"Ed and Gwen Reisner","join":"2025-09-06","exit":"2025-09-26","nums":[9,10,11,18,23],"pb":24,"qp":false},{"id":"C","name":"Wayne and Kathy","join":"2025-09-06","exit":null,"nums":[11,27,32,35,43],"pb":20,"qp":true},{"id":"D","name":"Janey and Andy Kraft","join":"2025-09-06","exit":null,"nums":[3,8,17,30,55],"pb":22,"qp":false},{"id":"E","name":"Ellen and Trevor","join":"2025-09-06","exit":null,"nums":[10,21,41,47,48],"pb":21,"qp":true},{"id":"F","name":"Kim and Al","join":"2025-09-06","exit":"2025-09-26","nums":[17,25,27,38,45],"pb":26,"qp":true},{"id":"G","name":"Julie Skarbeck, Bob Raymond","join":"2025-09-06","exit":null,"nums":[4,5,15,16,24],"pb":4,"qp":false},{"id":"H","name":"Sue Brauer","join":"2025-09-06","exit":null,"nums":[29,39,55,58,69],"pb":10,"qp":true},{"id":"I","name":"Patricia Zegarski","join":"2025-09-06","exit":null,"nums":[11,30,35,39,69],"pb":5,"qp":true},{"id":"J","name":"Georgi Diaz","join":"2025-09-27","exit":null,"nums":[25,35,47,52,63],"pb":15,"qp":true},{"id":"K","name":"Ella Detrizio","join":"2025-09-27","exit":null,"nums":[4,5,10,11,31],"pb":26,"qp":false},{"id":"L","name":"Chuck and MaryLou","join":"2025-12-20","exit":null,"nums":[6,7,9,12,22],"pb":22,"qp":false}],"periods":[{"s":"2025-09-06","l":"Period 1","w":3},{"s":"2025-09-27","l":"Period 2","w":3},{"s":"2025-10-18","l":"Period 3","w":3},{"s":"2025-11-08","l":"Period 4","w":3},{"s":"2025-11-29","l":"Period 5","w":3},{"s":"2025-12-19","l":"Period 6","w":4},{"s":"2026-01-17","l":"Period 7","w":4},{"s":"2026-02-14","l":"Period 8","w":4},{"s":"2026-03-14","l":"Period 9","w":4}],"draws":[{"num":1,"date":"2025-09-06","w":[11,23,44,61,62],"pb":17,"prize":0},{"num":2,"date":"2025-09-08","w":[26,28,41,53,64],"pb":9,"prize":0},{"num":3,"date":"2025-09-10","w":[2,24,45,53,64],"pb":5,"prize":4},{"num":4,"date":"2025-09-13","w":[28,37,42,50,53],"pb":19,"prize":0},{"num":5,"date":"2025-09-15","w":[14,15,32,42,49],"pb":1,"prize":0},{"num":6,"date":"2025-09-17","w":[7,30,50,54,62],"pb":20,"prize":4},{"num":7,"date":"2025-09-20","w":[15,29,64,66,67],"pb":4,"prize":4},{"num":8,"date":"2025-09-22","w":[3,29,42,46,59],"pb":15,"prize":0},{"num":9,"date":"2025-09-24","w":[15,31,45,49,53],"pb":19,"prize":0},{"num":10,"date":"2025-09-27","w":[10,16,32,61,66],"pb":4,"prize":4},{"num":11,"date":"2025-09-29","w":[1,3,27,60,65],"pb":16,"prize":0},{"num":12,"date":"2025-10-01","w":[8,17,22,28,55],"pb":14,"prize":7},{"num":13,"date":"2025-10-04","w":[3,7,47,67,68],"pb":2,"prize":0},{"num":14,"date":"2025-10-06","w":[28,29,32,66,67],"pb":3,"prize":0},{"num":15,"date":"2025-10-08","w":[8,10,44,48,54],"pb":14,"prize":0},{"num":16,"date":"2025-10-11","w":[13,16,18,20,27],"pb":10,"prize":4},{"num":17,"date":"2025-10-13","w":[13,14,32,52,64],"pb":12,"prize":0},{"num":18,"date":"2025-10-15","w":[10,13,28,34,47],"pb":15,"prize":4},{"num":19,"date":"2025-10-18","w":[3,11,27,40,58],"pb":10,"prize":4},{"num":20,"date":"2025-10-20","w":[32,38,66,67,69],"pb":19,"prize":0},{"num":21,"date":"2025-10-22","w":[18,37,52,54,60],"pb":12,"prize":0},{"num":22,"date":"2025-10-25","w":[2,12,22,39,67],"pb":15,"prize":4},{"num":23,"date":"2025-10-27","w":[17,39,43,51,66],"pb":20,"prize":4},{"num":24,"date":"2025-10-29","w":[4,24,49,60,65],"pb":1,"prize":0},{"num":25,"date":"2025-11-01","w":[2,26,43,44,62],"pb":22,"prize":4},{"num":26,"date":"2025-11-03","w":[3,32,40,43,57],"pb":18,"prize":0},{"num":27,"date":"2025-11-05","w":[9,17,29,61,66],"pb":26,"prize":4},{"num":28,"date":"2025-11-08","w":[3,53,60,62,68],"pb":11,"prize":0},{"num":29,"date":"2025-11-10","w":[6,28,44,48,58],"pb":23,"prize":4},{"num":30,"date":"2025-11-12","w":[29,39,43,51,65],"pb":23,"prize":4},{"num":31,"date":"2025-11-15","w":[6,7,12,47,53],"pb":21,"prize":4},{"num":32,"date":"2025-11-17","w":[7,33,50,57,66],"pb":23,"prize":4},{"num":33,"date":"2025-11-19","w":[10,31,49,51,68],"pb":19,"prize":0},{"num":34,"date":"2025-11-22","w":[28,32,36,51,69],"pb":2,"prize":0},{"num":35,"date":"2025-11-24","w":[8,16,26,30,58],"pb":14,"prize":0},{"num":36,"date":"2025-11-26","w":[7,8,15,19,28],"pb":3,"prize":0},{"num":37,"date":"2025-11-29","w":[19,22,30,32,59],"pb":1,"prize":0},{"num":38,"date":"2025-12-01","w":[5,18,26,47,59],"pb":1,"prize":0},{"num":39,"date":"2025-12-03","w":[1,14,20,46,51],"pb":26,"prize":4},{"num":40,"date":"2025-12-06","w":[13,14,26,28,44],"pb":7,"prize":0},{"num":41,"date":"2025-12-08","w":[8,32,52,56,64],"pb":23,"prize":4},{"num":42,"date":"2025-12-10","w":[10,16,29,33,69],"pb":22,"prize":4},{"num":43,"date":"2025-12-13","w":[1,28,31,57,58],"pb":16,"prize":0},{"num":44,"date":"2025-12-15","w":[23,35,59,63,68],"pb":2,"prize":0},{"num":45,"date":"2025-12-17","w":[25,33,53,62,66],"pb":17,"prize":0},{"num":46,"date":"2025-12-20","w":[4,5,28,52,69],"pb":20,"prize":4},{"num":47,"date":"2025-12-22","w":[3,18,36,41,54],"pb":7,"prize":0},{"num":48,"date":"2025-12-24","w":[4,25,31,52,59],"pb":19,"prize":0},{"num":49,"date":"2025-12-27","w":[5,20,34,39,62],"pb":1,"prize":0},{"num":50,"date":"2025-12-29","w":[11,19,34,48,53],"pb":21,"prize":4},{"num":51,"date":"2025-12-31","w":[11,18,21,24,38],"pb":26,"prize":4},{"num":52,"date":"2026-01-03","w":[18,21,40,53,60],"pb":23,"prize":4},{"num":53,"date":"2026-01-05","w":[4,18,24,51,56],"pb":14,"prize":0},{"num":54,"date":"2026-01-07","w":[15,28,57,58,63],"pb":23,"prize":4},{"num":55,"date":"2026-01-10","w":[5,19,21,28,64],"pb":14,"prize":0},{"num":56,"date":"2026-01-12","w":[5,27,45,56,59],"pb":4,"prize":4},{"num":57,"date":"2026-01-14","w":[6,24,39,43,51],"pb":2,"prize":0},{"num":58,"date":"2026-01-17","w":[5,8,27,49,57],"pb":14,"prize":0},{"num":59,"date":"2026-01-19","w":[5,28,34,37,55],"pb":17,"prize":0},{"num":60,"date":"2026-01-21","w":[11,26,27,53,55],"pb":12,"prize":0},{"num":61,"date":"2026-01-24","w":[2,16,35,61,63],"pb":5,"prize":4},{"num":62,"date":"2026-01-26","w":[21,31,51,60,63],"pb":18,"prize":0},{"num":63,"date":"2026-01-28","w":[21,35,40,46,68],"pb":11,"prize":0},{"num":64,"date":"2026-01-31","w":[2,8,14,40,63],"pb":23,"prize":4},{"num":65,"date":"2026-02-02","w":[3,8,31,60,65],"pb":4,"prize":4},{"num":66,"date":"2026-02-04","w":[27,29,30,37,58],"pb":15,"prize":4},{"num":67,"date":"2026-02-07","w":[25,36,42,51,58],"pb":6,"prize":0},{"num":68,"date":"2026-02-09","w":[6,19,22,28,48],"pb":24,"prize":0},{"num":69,"date":"2026-02-11","w":[6,20,33,40,48],"pb":5,"prize":4}],"payments":{"A":{"0":20,"1":16,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"B":{"0":20},"C":{"0":20,"1":16,"2":20,"3":18,"4":20,"5":22,"6":25,"7":25},"D":{"0":20,"1":16,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"E":{"0":20,"1":16,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"F":{"0":20},"G":{"0":20,"1":18,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"H":{"0":18,"1":18,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"I":{"0":20,"1":16,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"J":{"1":18,"2":18,"3":20,"4":20,"5":20,"6":24,"7":24,"8":24},"K":{"1":18,"2":18,"3":18,"4":18,"5":24,"6":24,"7":24},"L":{"5":22,"6":24,"7":24}}};

  const applyData=(d)=>{
    setData(d);setError(null);setLastRefresh(new Date());
    setEditMembers(d.members);setEditDraws(d.draws);setEditPeriods(d.periods);setEditPayments(d.payments||{});
  };

  const loadData=async()=>{
    try{
      const res=await fetch('data.json?t='+Date.now());
      if(!res.ok)throw new Error('fetch failed');
      const d=await res.json();
      applyData(d);
      setEditDraws(d.draws);
      setEditPeriods(d.periods);
      setEditPayments(d.payments||{});
    }catch(e){
      // Fallback to embedded data (works in Claude preview and local file://)
      if(!data)applyData(EMBEDDED_DATA);
    }
  };
  useEffect(()=>{loadData()},[]);
  useEffect(()=>{if(!isAdmin){const iv=setInterval(loadData,5*60*1000);return()=>clearInterval(iv)}},[isAdmin]);

  const doLogin=async()=>{
    const ok=await checkPassword(pwInput);
    if(ok){setIsAdmin(true);setShowLogin(false);setPwInput("");setPwError("")}
    else{setPwError("Incorrect password")}
  };
  const doLogout=()=>{setIsAdmin(false);loadData()};

  if(!data)return <div className="min-h-screen bg-slate-950 flex items-center justify-center"><div className="text-center"><div className="loader mx-auto mb-4"></div><p className="text-slate-400 text-sm">Loading syndicate data...</p></div></div>;

  // Use admin edits if in admin mode, otherwise use loaded data
  const members=isAdmin?(editMembers||data.members):data.members;
  const draws=isAdmin?(editDraws||data.draws):data.draws;
  const periods=isAdmin?(editPeriods||data.periods):data.periods;
  const payments=isAdmin?(editPayments||data.payments||{}):{};

  const actM=members.filter(m=>!m.exit);
  const completedDraws=draws.filter(d=>!isEmpty(d));

  const pStats=(()=>{
    const sorted=[...periods].sort((a,b)=>a.s.localeCompare(b.s));
    return sorted.map((p,i)=>{
      const nx=sorted[i+1]?.s||"9999-12-31";const pd=draws.filter(d=>d.date>=p.s&&d.date<nx);
      const tp=pd.reduce((s,d)=>s+(d.prize||0),0);const act=members.filter(m=>isAct(m,p.s));
      const pm=act.length>0?tp/act.length:0;const dpp=p.w===4?12:9;
      return{...p,idx:i,draws:pd,tp,ac:act.length,pm,actMs:act,dpp,cost:dpp*2};
    });
  })();

  const mWin={};members.forEach(m=>{mWin[m.id]=0});pStats.forEach(ps=>{ps.actMs.forEach(m=>{mWin[m.id]=(mWin[m.id]||0)+ps.pm})});
  const totW=draws.reduce((s,d)=>s+(d.prize||0),0);

  // Admin edit functions
  const saveDraw=draw=>{setEditDraws(prev=>{
    const arr=prev||[];
    const placeholder=arr.findIndex(d=>d.date===draw.date&&isEmpty(d));
    if(placeholder>=0){const n=[...arr];n[placeholder]={...n[placeholder],w:draw.w,pb:draw.pb,prize:draw.prize};return n}
    const ex=arr.findIndex(d=>d.num===draw.num);
    if(ex>=0){const n=[...arr];n[ex]=draw;return n.sort((a,b)=>a.date.localeCompare(b.date))}
    return [...arr,{...draw,num:arr.length+1}].sort((a,b)=>a.date.localeCompare(b.date));
  });setModal(null)};

  const saveMem=mem=>{setEditMembers(prev=>{
    const arr=prev||[];
    if(arr.find(m=>m.id===mem.id))return arr.map(m=>m.id===mem.id?mem:m);
    const ids=arr.map(m=>m.id);const nid="ABCDEFGHIJKLMNO".split("").find(c=>!ids.includes(c));
    return[...arr,{...mem,id:nid}];
  });setModal(null)};

  const savePay=(mid,pi,amt)=>{setEditPayments(prev=>{const n={...prev};if(!n[mid])n[mid]={};n[mid]={...n[mid],[pi]:amt};return n})};

  const genDrawDates=(startStr,weeks)=>{
    const start=new Date(startStr+"T12:00:00");const dates=[];
    const end=new Date(start);end.setDate(end.getDate()+weeks*7);const cur=new Date(start);
    while(cur<end){if([1,3,6].includes(cur.getDay()))dates.push(cur.toISOString().slice(0,10));cur.setDate(cur.getDate()+1)}
    return dates;
  };
  const addPeriod=()=>{
    const sorted=[...(editPeriods||periods)].sort((a,b)=>a.s.localeCompare(b.s));const last=sorted[sorted.length-1];
    const lastStart=new Date(last.s+"T12:00:00");const newStart=new Date(lastStart);newStart.setDate(newStart.getDate()+last.w*7);
    const newStartStr=newStart.toISOString().slice(0,10);const newNum=sorted.length+1;
    const newPeriod={s:newStartStr,l:`Period ${newNum}`,w:4};
    const drawDates=genDrawDates(newStartStr,4);
    const maxNum=(editDraws||draws).reduce((mx,d)=>Math.max(mx,d.num),0);
    const newDraws=drawDates.map((dt,i)=>({num:maxNum+i+1,date:dt,w:[0,0,0,0,0],pb:0,prize:0}));
    setEditPeriods(prev=>[...(prev||periods),newPeriod]);
    setEditDraws(prev=>[...(prev||draws),...newDraws].sort((a,b)=>a.date.localeCompare(b.date)));
    setModal(null);
  };

  const exportData=()=>{
    const exp={lastUpdated:new Date().toISOString().slice(0,10),
      members:members.map(m=>({id:m.id,name:m.name,join:m.join,exit:m.exit,nums:m.nums,pb:m.pb,qp:m.qp||false})),
      periods:periods,
      draws:draws.filter(d=>!isEmpty(d)).map(d=>({num:d.num,date:d.date,w:getW(d),pb:d.pb,prize:d.prize})),
      payments:payments};
    const json=JSON.stringify(exp,null,2);
    const blob=new Blob([json],{type:'application/json'});
    const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='data.json';a.click();URL.revokeObjectURL(url);
  };

  const saveToGitHub=async()=>{
    if(!ghSettings.user||!ghSettings.repo||!ghSettings.token){setShowGhSettings(true);return}
    setGhStatus('saving');
    try{
      const exp={lastUpdated:new Date().toISOString().slice(0,10),
        members:members.map(m=>({id:m.id,name:m.name,join:m.join,exit:m.exit,nums:m.nums,pb:m.pb,qp:m.qp||false})),
        periods:periods,
        draws:draws.filter(d=>!isEmpty(d)).map(d=>({num:d.num,date:d.date,w:getW(d),pb:d.pb,prize:d.prize})),
        payments:payments};
      const json=JSON.stringify(exp,null,2);
      const apiUrl=`https://api.github.com/repos/${ghSettings.user}/${ghSettings.repo}/contents/data.json`;
      // Get current file SHA (needed for update)
      const getRes=await fetch(apiUrl,{headers:{'Authorization':`token ${ghSettings.token}`,'Accept':'application/vnd.github.v3+json'}});
      const sha=getRes.ok?(await getRes.json()).sha:undefined;
      // Create or update file
      const putRes=await fetch(apiUrl,{method:'PUT',headers:{'Authorization':`token ${ghSettings.token}`,'Content-Type':'application/json','Accept':'application/vnd.github.v3+json'},
        body:JSON.stringify({message:`Update data.json â€” ${new Date().toLocaleDateString()}`,content:btoa(unescape(encodeURIComponent(json))),sha:sha,branch:'main'})});
      if(!putRes.ok)throw new Error(`GitHub API: ${putRes.status}`);
      setGhStatus('saved');setTimeout(()=>setGhStatus(null),3000);
    }catch(e){console.error('GitHub save failed:',e);setGhStatus('error');setTimeout(()=>setGhStatus(null),4000)}
  };

  const nav=[{k:"dash",l:"Dashboard",i:"dash"},{k:"mem",l:"Members",i:"mem"},{k:"drw",l:"Draws",i:"drw"},{k:"win",l:"Winnings",i:"mon"},{k:"charts",l:"Charts",i:"chart"}];
  if(isAdmin)nav.push({k:"pay",l:"Payments",i:"pay"});

  return (
    <div className="min-h-screen bg-slate-950 text-slate-100">
      <div className="fixed inset-0 opacity-[0.02]" style={{backgroundImage:"radial-gradient(circle at 1px 1px, white 1px, transparent 0)",backgroundSize:"32px 32px"}} />
      <header className="relative z-10 border-b border-slate-800/60 bg-slate-950/80 backdrop-blur-xl sticky top-0">
        <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-9 h-9 rounded-xl bg-gradient-to-br from-amber-400 to-rose-500 flex items-center justify-center shadow-lg shadow-amber-500/20"><span className="text-lg">ğŸ±</span></div>
            <div><h1 className="text-base font-bold tracking-tight text-white leading-tight">Lotto Syndicate <span className="text-[9px] font-normal text-slate-600 ml-1">v26.2.26.1</span></h1>
              <p className="text-[10px] text-slate-500 tracking-widest uppercase">{isAdmin?"Admin Mode":"Powerball Tracker"}</p></div>
          </div>
          <div className="flex items-center gap-2">
            {isAdmin&&<button onClick={saveToGitHub} disabled={ghStatus==='saving'} className={`px-2.5 py-1.5 rounded-lg text-[10px] font-medium transition-colors flex items-center gap-1 border ${ghStatus==='saved'?"bg-emerald-600/20 border-emerald-500/30 text-emerald-400":ghStatus==='error'?"bg-rose-600/20 border-rose-500/30 text-rose-400":ghStatus==='saving'?"bg-amber-600/20 border-amber-500/30 text-amber-400 opacity-70":"bg-emerald-600/20 hover:bg-emerald-600/30 border-emerald-500/30 text-emerald-400"}`}>{ghStatus==='saving'?<><span className="loader" style={{width:10,height:10,borderWidth:2}}/> Saving...</>:ghStatus==='saved'?<><Ic n="check" s={12}/> Saved!</>:ghStatus==='error'?<><Ic n="x" s={12}/> Failed</>:<><Ic n="gh" s={12}/> Save to GitHub</>}</button>}
            {isAdmin&&<button onClick={()=>setShowGhSettings(true)} title="GitHub settings" className="p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors"><Ic n="gear" s={14}/></button>}
            {isAdmin&&<button onClick={exportData} className="px-2.5 py-1.5 bg-sky-600/20 hover:bg-sky-600/30 border border-sky-500/30 text-sky-400 rounded-lg text-[10px] font-medium transition-colors flex items-center gap-1"><Ic n="dl" s={12}/> Export</button>}
            <button onClick={()=>{if(isAdmin)doLogout();else setShowLogin(true)}} title={isAdmin?"Lock admin":"Unlock admin"} className={`p-1.5 rounded-lg transition-colors ${isAdmin?"bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600/30":"text-slate-500 hover:bg-slate-800 hover:text-slate-300"}`}><Ic n={isAdmin?"unlock":"lock"} s={14}/></button>
            {!isAdmin&&<button onClick={loadData} title="Refresh" className="p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors"><Ic n="ref" s={14}/></button>}
            <nav className="flex gap-0.5 bg-slate-900/60 rounded-xl p-0.5 border border-slate-800/50">
              {nav.map(n=><button key={n.k} onClick={()=>setTab(n.k)} className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${tab===n.k?"bg-slate-800 text-white shadow-md":"text-slate-400 hover:text-slate-200 hover:bg-slate-800/40"}`}><Ic n={n.i} s={14}/><span className="hidden md:inline">{n.l}</span></button>)}
            </nav>
          </div>
        </div>
      </header>
      <main className="relative z-10 max-w-7xl mx-auto px-4 py-5">
        {tab==="dash"&&<Dash {...{members,actM,completedDraws,draws,totW,pStats,mWin,setTab,isAdmin,setModal,payments}}/>}
        {tab==="mem"&&<MemTab {...{members,mWin,isAdmin,onAdd:()=>setModal({t:"mem"}),onEdit:m=>setModal({t:"mem",d:m})}}/>}
        {tab==="drw"&&<DrwTab {...{draws,members,isAdmin,onAdd:()=>setModal({t:"drw"})}}/>}
        {tab==="win"&&<WinTab {...{members,pStats,mWin}}/>}
        {tab==="charts"&&<ChartsTab {...{members,actM,completedDraws,draws,pStats,mWin}}/>}
        {tab==="pay"&&isAdmin&&<PayTab {...{members,pStats,payments,onSave:savePay}}/>}
      </main>
      {modal?.t==="summary"&&<PeriodSummaryModal members={members} pStats={pStats} mWin={mWin} payments={payments} isAdmin={isAdmin} onClose={()=>setModal(null)}/>}
      {isAdmin&&modal?.t==="drw"&&<AddDrawWizard members={members} onClose={()=>setModal(null)} onSave={saveDraw} nextNum={draws.length+1}/>}
      {isAdmin&&modal?.t==="mem"&&<MemModal onClose={()=>setModal(null)} onSave={saveMem} member={modal.d}/>}
      {isAdmin&&modal?.t==="per"&&<AddPeriodModal periods={periods} onClose={()=>setModal(null)} onAdd={addPeriod}/>}
      {showGhSettings&&<GhSettingsModal settings={ghSettings} onSave={(s)=>{saveGhSettings(s);setShowGhSettings(false)}} onClose={()=>setShowGhSettings(false)}/>}
      {showLogin&&<LoginModal onClose={()=>{setShowLogin(false);setPwInput("");setPwError("")}} pwInput={pwInput} setPwInput={setPwInput} pwError={pwError} onLogin={doLogin}/>}
      <footer className="relative z-10 border-t border-slate-800/40 mt-8 py-4 text-center text-[10px] text-slate-600">
        Data updated {fmt(data.lastUpdated)}{!isAdmin&&lastRefresh&&<span> Â· Last checked {lastRefresh.toLocaleTimeString()}</span>}{isAdmin&&<span> Â· Admin mode{ghSettings.token?" â€” Save to GitHub when done":" â€” set up GitHub connection (âš™) to auto-save"}</span>}
      </footer>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function LoginModal({onClose,pwInput,setPwInput,pwError,onLogin}){
  return <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
    <div className="bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-sm shadow-2xl" onClick={e=>e.stopPropagation()}>
      <div className="flex items-center gap-3 mb-5"><div className="w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center"><Ic n="lock" s={20}/></div><div><h3 className="text-base font-bold text-white">Admin Access</h3><p className="text-[11px] text-slate-400">Enter password to unlock editing</p></div></div>
      <input type="password" value={pwInput} onChange={e=>setPwInput(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")onLogin()}} placeholder="Password" autoFocus
        className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm text-white mb-2 focus:ring-2 focus:ring-amber-500/50 focus:outline-none focus:border-amber-500/50"/>
      {pwError&&<p className="text-xs text-rose-400 mb-2">{pwError}</p>}
      <div className="flex gap-2 mt-3">
        <button onClick={onClose} className="flex-1 px-4 py-2.5 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">Cancel</button>
        <button onClick={onLogin} className="flex-1 px-4 py-2.5 bg-amber-600 hover:bg-amber-500 rounded-xl text-sm text-white font-medium">Unlock</button>
      </div>
    </div>
  </div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GITHUB SETTINGS MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function GhSettingsModal({settings,onSave,onClose}){
  const[f,setF]=useState({...settings});
  return <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
    <div className="bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-sm shadow-2xl" onClick={e=>e.stopPropagation()}>
      <div className="flex items-center gap-3 mb-5"><div className="w-10 h-10 rounded-xl bg-sky-500/10 flex items-center justify-center"><Ic n="gh" s={20}/></div><div><h3 className="text-base font-bold text-white">GitHub Connection</h3><p className="text-[11px] text-slate-400">Save data.json directly to your repo</p></div></div>
      <div className="space-y-3">
        <div><label className="block text-[10px] text-slate-400 mb-1 uppercase">GitHub Username</label>
        <input type="text" value={f.user} onChange={e=>setF(p=>({...p,user:e.target.value}))} placeholder="e.g. kddyke23-oss" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-sky-500/50 focus:outline-none"/></div>
        <div><label className="block text-[10px] text-slate-400 mb-1 uppercase">Repository Name</label>
        <input type="text" value={f.repo} onChange={e=>setF(p=>({...p,repo:e.target.value}))} placeholder="e.g. Lotto-Syndicate" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-sky-500/50 focus:outline-none"/></div>
        <div><label className="block text-[10px] text-slate-400 mb-1 uppercase">Personal Access Token</label>
        <input type="password" value={f.token} onChange={e=>setF(p=>({...p,token:e.target.value}))} placeholder="ghp_..." className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white font-mono focus:ring-2 focus:ring-sky-500/50 focus:outline-none"/>
        <p className="text-[9px] text-slate-500 mt-1">Needs "repo" scope. Create at GitHub Settings &gt; Developer settings &gt; Tokens (classic)</p></div>
      </div>
      <div className="flex gap-2 mt-4">
        <button onClick={onClose} className="flex-1 px-4 py-2.5 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">Cancel</button>
        <button onClick={()=>onSave(f)} disabled={!f.user||!f.repo||!f.token} className="flex-1 px-4 py-2.5 bg-sky-600 hover:bg-sky-500 disabled:opacity-40 disabled:cursor-not-allowed rounded-xl text-sm text-white font-medium">Save</button>
      </div>
    </div>
  </div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADD DRAW WIZARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function AddDrawWizard({members,onClose,onSave,nextNum}){
  const[step,setStep]=useState(1);
  const[date,setDate]=useState("");const[nums,setNums]=useState(["","","","",""]);const[pb,setPb]=useState("");const[prize,setPrize]=useState("");
  const[matchData,setMatchData]=useState(null);
  const doCheck=()=>{const w=nums.map(Number).filter(n=>n>0);if(w.length!==5||!pb||!date)return;const result=checkWinTrigger(members,date,w,Number(pb));setMatchData({...result,winning:w,pbNum:Number(pb)});setStep(2)};
  const doSave=()=>{onSave({num:nextNum,date,w:matchData.winning,pb:matchData.pbNum,prize:matchData.isWinner?Number(prize)||0:0})};
  return (<Modal title="Add Draw Result" onClose={onClose}>
    {step===1&&<div className="space-y-4">
      <p className="text-xs text-slate-400">Step 1 â€” Enter the draw numbers</p>
      <div><label className="block text-[10px] text-slate-400 mb-1 uppercase tracking-wider">Draw Date</label><input type="date" value={date} onChange={e=>setDate(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white"/></div>
      <div><label className="block text-[10px] text-slate-400 mb-1 uppercase tracking-wider">Winning Numbers (5)</label><div className="flex gap-2">{[0,1,2,3,4].map(i=><input key={i} type="number" min="1" max="69" value={nums[i]} onChange={e=>{const a=[...nums];a[i]=e.target.value;setNums(a)}} className="w-14 bg-slate-800 border border-slate-700 rounded-lg px-2 py-2 text-sm text-white text-center font-mono" placeholder={`#${i+1}`}/>)}</div></div>
      <div><label className="block text-[10px] text-slate-400 mb-1 uppercase tracking-wider">Powerball</label><input type="number" min="1" max="26" value={pb} onChange={e=>setPb(e.target.value)} className="w-20 bg-slate-800 border border-rose-500/30 rounded-lg px-2 py-2 text-sm text-rose-300 font-mono text-center"/></div>
      <div className="flex gap-2 pt-2"><button onClick={onClose} className="flex-1 px-4 py-2.5 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">Cancel</button><button onClick={doCheck} disabled={nums.filter(n=>n&&Number(n)>0).length!==5||!pb||!date} className="flex-1 px-4 py-2.5 bg-sky-600 hover:bg-sky-500 disabled:opacity-40 disabled:cursor-not-allowed rounded-xl text-sm text-white font-medium">Check Numbers â†’</button></div>
    </div>}
    {step===2&&matchData&&<div className="space-y-4">
      <div className="bg-slate-800/50 rounded-xl p-3"><p className="text-[10px] text-slate-500 uppercase">Draw #{nextNum} Â· {fmtS(date)}</p><div className="flex gap-1 mt-1">{matchData.winning.map((n,i)=><Bl key={i} number={n}/>)}<Bl number={matchData.pbNum} isPb/></div></div>
      <div><h4 className="text-xs font-semibold text-slate-300 uppercase tracking-wider mb-2">Member Matches</h4>
        <div className="space-y-1.5 max-h-64 overflow-y-auto">{matchData.results.sort((a,b)=>b.sc-a.sc).map(r=>{const isT=r.m>=3||r.pb;return <div key={r.id} className={`flex items-center gap-2 text-xs p-2 rounded-lg ${isT?"bg-emerald-500/10 border border-emerald-500/20":"bg-slate-800/30"}`}><span className={`w-6 h-6 rounded text-[10px] flex items-center justify-center font-bold ${isT?"bg-emerald-500 text-white":"bg-slate-800 text-slate-400"}`}>{r.id}</span><span className="text-slate-300 w-28 truncate">{r.name.split(",")[0].split(" and ")[0]}</span><div className="flex gap-0.5">{r.nums.map((n,i)=><Bl key={i} number={n} isMatch={matchData.winning.includes(n)} small/>)}<Bl number={r.pb} isPb isMatch={r.pb===matchData.pbNum} small/></div><div className="ml-auto flex items-center gap-1.5">{r.m>0&&<span className="text-[10px] font-mono bg-slate-700 text-slate-300 px-1.5 py-0.5 rounded">{r.m}</span>}{r.pb&&<span className="text-[10px] font-mono bg-amber-500/20 text-amber-300 px-1.5 py-0.5 rounded">PB âœ“</span>}{isT&&<span className="text-[10px] text-emerald-400">â˜…</span>}</div></div>})}
        {matchData.results.filter(r=>r.sc>0).length===0&&<p className="text-xs text-slate-500 italic py-2">No matching numbers</p>}</div></div>
      {matchData.isWinner?<div className="bg-gradient-to-r from-emerald-500/10 to-amber-500/10 border border-emerald-500/30 rounded-xl p-4"><div className="flex items-center gap-2 mb-3"><span className="text-lg">ğŸ‰</span><div><p className="text-sm font-bold text-emerald-300">Winner!</p><p className="text-[10px] text-slate-400">{matchData.triggered.map(t=>{const r=[];if(t.m>=3)r.push(`${t.m} nums`);if(t.pb)r.push("PB");return `${t.id}(${r.join("+")})`;}).join(", ")}</p></div></div><label className="block text-[10px] text-slate-400 mb-1 uppercase">Prize Amount ($)</label><input type="number" min="0" value={prize} onChange={e=>setPrize(e.target.value)} autoFocus className="w-full bg-slate-800 border border-emerald-500/40 rounded-lg px-4 py-3 text-lg text-emerald-300 font-mono text-center" placeholder="Enter winnings..."/></div>:<div className="bg-slate-800/30 border border-slate-700/50 rounded-xl p-4 text-center"><p className="text-sm text-slate-400">No winning matches</p></div>}
      <div className="flex gap-2 pt-1"><button onClick={()=>{setStep(1);setMatchData(null)}} className="flex-1 px-4 py-2.5 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">â† Back</button><button onClick={doSave} disabled={matchData.isWinner&&(!prize||Number(prize)<=0)} className="flex-1 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-500 disabled:opacity-40 disabled:cursor-not-allowed rounded-xl text-sm text-white font-medium">{matchData.isWinner?"Save with Prize":"Save Draw"}</button></div>
    </div>}
  </Modal>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function Dash({members,actM,completedDraws,draws,totW,pStats,mWin,setTab,isAdmin,setModal,payments}){
  const recent=useMemo(()=>[...completedDraws].sort((a,b)=>b.date.localeCompare(a.date)).slice(0,8).map(dr=>{
    const w=getW(dr);const res=members.filter(m=>!m.exit||m.exit>dr.date).map(m=>{const r=getMatches(m.nums,m.pb,w,dr.pb);return{...m,...r}}).filter(r=>r.sc>0).sort((a,b)=>b.sc-a.sc);
    return{...dr,w,res};
  }),[completedDraws,members]);
  const curP=pStats.find((p,i)=>{const nx=pStats[i+1]?.s||"9999-12-31";const td=new Date().toISOString().slice(0,10);return td>=p.s&&td<nx})||pStats[pStats.length-1];
  const top=Object.entries(mWin).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const wr=completedDraws.length>0?(draws.filter(d=>d.prize>0).length/completedDraws.length*100).toFixed(0):0;
  const pendingDraws=draws.filter(d=>isEmpty(d)).length;
  return (
    <div className="space-y-5">
      <div className="grid grid-cols-2 lg:grid-cols-5 gap-3">
        <St l="Active" v={actM.length} s={`of ${members.length} total`} c="emerald"/>
        <St l="Draws" v={completedDraws.length} s={pendingDraws>0?`${pendingDraws} pending Â· ${wr}% win`:`${wr}% win rate`} c="sky"/>
        <St l="Total Won" v={`$${totW}`} s={`${draws.filter(d=>d.prize>0).length} winning draws`} c="amber"/>
        <St l="Current" v={curP?.l} s={`${curP?.w}wk Â· ${curP?.ac} members`} c="violet"/>
        <St l="Per Member" v={`$${(totW/(actM.length||1)).toFixed(1)}`} s="avg total earnings" c="rose"/>
      </div>
      <div className="grid lg:grid-cols-3 gap-5">
        <div className="lg:col-span-2 bg-slate-900/50 border border-slate-800/50 rounded-2xl p-4">
          <div className="flex items-center justify-between mb-3"><h2 className="text-sm font-semibold text-white flex items-center gap-2"><Ic n="drw" s={15}/> Recent Draws</h2><button onClick={()=>setTab("drw")} className="text-xs text-slate-400 hover:text-white">View all â†’</button></div>
          <div className="space-y-1">{recent.map(dr=>(
            <div key={dr.num} className={`flex items-center justify-between py-1.5 px-2 rounded-lg ${dr.prize>0?"bg-emerald-500/5":""} border-b border-slate-800/30 last:border-0`}>
              <div className="flex items-center gap-2"><span className="text-[10px] text-slate-500 font-mono w-6">#{dr.num}</span><span className="text-xs text-slate-400 w-14">{fmtS(dr.date)}</span><div className="flex gap-0.5">{dr.w.map((n,i)=><Bl key={i} number={n} small/>)}<Bl number={dr.pb} isPb small/></div></div>
              <div className="flex items-center gap-2">{dr.res.length>0&&<span className="text-[10px] text-amber-400 bg-amber-500/10 px-1.5 py-0.5 rounded">{dr.res.length} match</span>}{dr.prize>0&&<span className="text-xs font-bold text-emerald-400 bg-emerald-500/10 px-2 py-0.5 rounded-full">${dr.prize}</span>}</div>
            </div>))}</div></div>
        <div className="space-y-4">
          <div className="bg-gradient-to-br from-amber-500/10 to-rose-500/10 border border-amber-500/20 rounded-2xl p-4">
            <div className="flex items-center gap-2 mb-3"><Ic n="tr" s={16}/><span className="text-xs font-semibold text-amber-300 uppercase tracking-wider">Top Earners</span></div>
            {top.map(([id,amt],i)=>{const m=members.find(x=>x.id===id);return m?<div key={id} className="flex items-center justify-between py-1.5"><div className="flex items-center gap-2"><span className={`w-5 h-5 rounded text-[10px] flex items-center justify-center font-bold ${i===0?"bg-amber-400 text-amber-950":"bg-slate-800 text-slate-400"}`}>{i+1}</span><span className="text-sm text-slate-200">{m.name.split(",")[0].split(" and ")[0]}</span></div><span className="text-sm font-bold text-amber-300 font-mono">${amt.toFixed(2)}</span></div>:null})}</div>
          <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl p-4">
            <div className="flex items-center justify-between mb-3"><h3 className="text-xs font-semibold text-white uppercase tracking-wider">Periods</h3><button onClick={()=>setTab("win")} className="text-[10px] text-slate-400 hover:text-white">Details â†’</button></div>
            <div className="space-y-1.5">{pStats.map((p,i)=><div key={i} className="flex items-center justify-between text-xs"><div className="flex items-center gap-2"><span className="text-slate-500">{p.l}</span><span className={`text-[9px] px-1 py-0.5 rounded ${p.w===4?"bg-violet-500/10 text-violet-400":"bg-sky-500/10 text-sky-400"}`}>{p.w}wk</span></div><div className="flex items-center gap-1.5"><span className={`font-mono ${p.tp>0?"text-emerald-400":"text-slate-600"}`}>${p.tp}</span><span className="text-slate-600">Ã·{p.ac}</span></div></div>)}</div>
            <button onClick={()=>setModal({t:"summary"})} className="mt-3 w-full flex items-center justify-center gap-1.5 bg-amber-600/20 hover:bg-amber-600/30 border border-amber-500/30 text-amber-400 px-3 py-2 rounded-xl text-xs font-medium transition-colors"><Ic n="mail" s={13}/> Period Summary</button>
            {isAdmin&&<button onClick={()=>setModal({t:"per"})} className="mt-2 w-full flex items-center justify-center gap-1.5 bg-emerald-600/20 hover:bg-emerald-600/30 border border-emerald-500/30 text-emerald-400 px-3 py-2 rounded-xl text-xs font-medium transition-colors"><Ic n="pl" s={13}/> Add New Period</button>}</div>
          <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl p-4">
            <h3 className="text-xs font-semibold text-white uppercase tracking-wider mb-3">Our Numbers</h3>
            <div className="space-y-1.5">{actM.map(m=><div key={m.id} className="flex items-center gap-1.5"><span className="w-4 h-4 rounded bg-slate-800 text-[9px] flex items-center justify-center font-bold text-slate-500">{m.id}</span><div className="flex gap-0.5">{m.nums.map((n,i)=><Bl key={i} number={n} small/>)}<Bl number={m.pb} isPb small/></div>{m.qp&&<span className="text-[8px] text-violet-400 bg-violet-500/10 px-1 rounded">QP</span>}</div>)}</div></div>
        </div>
      </div>
    </div>);
}
function St({l,v,s,c}){const cs={emerald:"from-emerald-500/10 border-emerald-500/20 text-emerald-400",sky:"from-sky-500/10 border-sky-500/20 text-sky-400",amber:"from-amber-500/10 border-amber-500/20 text-amber-400",violet:"from-violet-500/10 border-violet-500/20 text-violet-400",rose:"from-rose-500/10 border-rose-500/20 text-rose-400"};
return <div className={`bg-gradient-to-br ${cs[c]} to-transparent border rounded-2xl p-3`}><p className="text-[10px] text-slate-400 uppercase tracking-wider">{l}</p><p className={`text-xl font-bold mt-0.5 ${cs[c].split(" ").pop()}`}>{v}</p><p className="text-[10px] text-slate-500 mt-0.5">{s}</p></div>}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MEMBERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function MemTab({members,mWin,isAdmin,onAdd,onEdit}){return (
  <div className="space-y-4"><div className="flex items-center justify-between"><h2 className="text-base font-bold">Members ({members.length})</h2>{isAdmin&&<button onClick={onAdd} className="flex items-center gap-1.5 bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-1.5 rounded-xl text-xs font-medium"><Ic n="pl" s={14}/> Add</button>}</div>
  <div className="grid gap-2.5">{members.map(m=><div key={m.id} className={`bg-slate-900/50 border rounded-2xl p-3 ${m.exit?"border-slate-800/30 opacity-50":"border-slate-800/50"}`}>
    <div className="flex flex-wrap items-center justify-between gap-2"><div className="flex items-center gap-3"><div className={`w-9 h-9 rounded-xl flex items-center justify-center font-bold text-sm ${m.exit?"bg-slate-800 text-slate-500":"bg-gradient-to-br from-sky-500 to-violet-500 text-white"}`}>{m.id}</div>
    <div><div className="flex items-center gap-2 flex-wrap"><p className="font-semibold text-white text-sm">{m.name}</p>{m.exit&&<span className="text-[10px] bg-rose-500/10 text-rose-400 px-1.5 py-0.5 rounded-full">Exited {fmtS(m.exit)}</span>}</div>
    <div className="flex items-center gap-1.5 mt-1.5"><div className="flex gap-0.5">{m.nums.map((n,i)=><Bl key={i} number={n} small/>)}<Bl number={m.pb} isPb small/></div>{m.qp&&<span className="text-[9px] text-violet-400 bg-violet-500/10 px-1 py-0.5 rounded">QP</span>}</div></div></div>
    <div className="flex items-center gap-3"><div className="text-right"><p className="text-[10px] text-slate-500">Winnings</p><p className="text-base font-bold text-emerald-400 font-mono">${(mWin[m.id]||0).toFixed(2)}</p><p className="text-[10px] text-slate-500">Since {fmtS(m.join)}</p></div>
    {isAdmin&&<button onClick={()=>onEdit(m)} className="p-1.5 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white"><Ic n="ed" s={14}/></button>}</div></div>
  </div>)}</div></div>
)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DRAWS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function DrwTab({draws,members,isAdmin,onAdd}){
  const sorted=useMemo(()=>[...draws].sort((a,b)=>b.date.localeCompare(a.date)),[draws]);
  const[exp,setExp]=useState(null);const[pg,setPg]=useState(0);const pp=20;
  const paged=sorted.slice(pg*pp,(pg+1)*pp);const pages=Math.ceil(sorted.length/pp);
  return (
    <div className="space-y-4"><div className="flex items-center justify-between"><h2 className="text-base font-bold">Draws ({draws.length})</h2>{isAdmin&&<button onClick={onAdd} className="flex items-center gap-1.5 bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-1.5 rounded-xl text-xs font-medium"><Ic n="pl" s={14}/> Add</button>}</div>
    <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl overflow-hidden"><table className="w-full text-xs"><thead><tr className="border-b border-slate-800/60"><th className="text-left px-3 py-2 text-slate-400 uppercase">#</th><th className="text-left px-3 py-2 text-slate-400 uppercase">Date</th><th className="text-left px-3 py-2 text-slate-400 uppercase">Numbers</th><th className="text-center px-3 py-2 text-slate-400 uppercase">Prize</th><th className="text-center px-3 py-2 text-slate-400 uppercase">Matches</th></tr></thead>
    <tbody>{paged.map(dr=>{
      const empty=isEmpty(dr);const w=getW(dr);
      const res=empty?[]:members.filter(m=>m.join<=dr.date&&(!m.exit||m.exit>dr.date)).map(m=>{const r=getMatches(m.nums,m.pb,w,dr.pb);return {...m,...r}}).filter(r=>r.sc>0).sort((a,b)=>b.sc-a.sc);
      const isE=exp===dr.num;
      return [
        <tr key={dr.num} className={`border-b border-slate-800/30 cursor-pointer hover:bg-slate-800/20 ${dr.prize>0?"bg-emerald-500/5":""} ${empty?"opacity-50":""}`} onClick={()=>!empty&&setExp(isE?null:dr.num)}>
          <td className="px-3 py-2 font-mono text-slate-400">{dr.num}</td><td className="px-3 py-2 text-slate-300">{fmt(dr.date)}</td>
          <td className="px-3 py-2">{empty?<span className="text-xs text-slate-500 italic">Pending</span>:<div className="flex gap-0.5">{w.map((n,i)=><Bl key={i} number={n} small/>)}<Bl number={dr.pb} isPb small/></div>}</td>
          <td className="px-3 py-2 text-center">{empty?<span className="text-slate-600">â€”</span>:dr.prize>0?<span className="text-emerald-400 font-bold">${dr.prize}</span>:<span className="text-slate-600">â€”</span>}</td>
          <td className="px-3 py-2 text-center">{empty?<span className="text-[10px] text-sky-400 bg-sky-500/10 px-1.5 py-0.5 rounded">pending</span>:<div className="flex items-center justify-center gap-1">{res.length>0?<span className="text-amber-400">{res.length}</span>:<span className="text-slate-600">0</span>}<Ic n={isE?"cu":"cv"} s={12}/></div>}</td></tr>,
        !empty&&isE&&<tr key={`${dr.num}e`}><td colSpan="5" className="px-3 py-3 bg-slate-900/80">{res.length>0?<div className="space-y-1.5">{res.map(r=>
          <div key={r.id} className="flex items-center gap-2 text-xs"><span className="w-5 h-5 rounded bg-slate-800 text-[9px] flex items-center justify-center font-bold text-slate-400">{r.id}</span><span className="text-slate-300 w-24 truncate">{r.name.split(",")[0]}</span>
          <div className="flex gap-0.5">{r.nums.map((n,i)=><Bl key={i} number={n} isMatch={w.includes(n)} small/>)}<Bl number={r.pb} isPb isMatch={r.pb===dr.pb} small/></div>
          <span className={`text-[10px] font-mono px-1.5 py-0.5 rounded ${r.sc>=10?"bg-amber-500/20 text-amber-300":"bg-slate-800 text-slate-400"}`}>{r.m}+{r.pb?"PB":"0"}</span></div>)}</div>:<p className="text-xs text-slate-500 italic">No matches</p>}</td></tr>
      ];})}</tbody></table>
    {pages>1&&<div className="flex items-center justify-center gap-1 py-3 border-t border-slate-800/40">{Array.from({length:pages},(_,i)=><button key={i} onClick={()=>setPg(i)} className={`w-7 h-7 rounded text-xs font-medium ${pg===i?"bg-slate-700 text-white":"text-slate-400 hover:text-white hover:bg-slate-800"}`}>{i+1}</button>)}</div>}
    </div></div>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WINNINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function WinTab({members,pStats,mWin}){return (
  <div className="space-y-4"><h2 className="text-base font-bold">Winnings Distribution</h2>
  <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl overflow-hidden"><div className="overflow-x-auto"><table className="w-full text-xs"><thead><tr className="border-b border-slate-800/60">
    <th className="text-left px-3 py-2 text-slate-400 uppercase sticky left-0 bg-slate-900/95 z-10 min-w-[100px]">Member</th>
    {pStats.map((p,i)=><th key={i} className="text-center px-2 py-2 text-slate-400 uppercase whitespace-nowrap min-w-[65px]"><div>{p.l}</div><div className="text-[9px] font-normal text-slate-500">{fmtS(p.s)}</div><div className={`text-[8px] font-normal ${p.w===4?"text-violet-400":"text-sky-400"}`}>{p.w}wk</div></th>)}
    <th className="text-center px-3 py-2 text-amber-400 uppercase font-bold">Total</th></tr></thead>
  <tbody>
    <tr className="border-b border-slate-700/60 bg-slate-800/30"><td className="px-3 py-1.5 text-[10px] font-semibold text-emerald-300 sticky left-0 bg-slate-800/50 z-10">Period Total</td>{pStats.map((p,i)=><td key={i} className="text-center px-2 py-1.5 text-[10px] font-bold text-emerald-400">${p.tp}</td>)}<td className="text-center px-3 py-1.5 text-[10px] font-bold text-amber-400">${pStats.reduce((s,p)=>s+p.tp,0)}</td></tr>
    <tr className="border-b border-slate-700/50 bg-slate-800/20"><td className="px-3 py-1 text-[10px] text-slate-500 sticky left-0 bg-slate-800/30 z-10">Active / Per Person</td>{pStats.map((p,i)=><td key={i} className="text-center px-2 py-1 text-[10px] text-slate-500">{p.ac} / ${p.pm.toFixed(2)}</td>)}<td/></tr>
    {members.map(m=><tr key={m.id} className={`border-b border-slate-800/30 ${m.exit?"opacity-40":""}`}><td className="px-3 py-1.5 text-slate-300 font-medium sticky left-0 bg-slate-900/95 z-10"><span className="inline-flex items-center gap-1.5"><span className="w-4 h-4 rounded text-[9px] flex items-center justify-center font-bold bg-slate-800 text-slate-400">{m.id}</span>{m.name.split(",")[0].split(" and ")[0]}</span></td>
    {pStats.map((p,i)=>{const a=isAct(m,p.s);const sh=a?p.pm:0;return <td key={i} className="text-center px-2 py-1.5">{a?<span className={`text-[10px] font-mono ${sh>0?"text-emerald-400":"text-slate-500"}`}>{sh>0?`$${sh.toFixed(2)}`:"$0"}</span>:<span className="text-[10px] text-slate-700">â€”</span>}</td>})}
    <td className="text-center px-3 py-1.5 font-bold text-amber-400 font-mono text-xs">${(mWin[m.id]||0).toFixed(2)}</td></tr>)}
  </tbody></table></div></div></div>
)}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAYMENTS (admin only) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function PayTab({members,pStats,payments,onSave}){
  const[ec,setEc]=useState(null);const[ev,setEv]=useState("");
  const se=(id,pi,cur)=>{setEc(`${id}-${pi}`);setEv(cur?.toString()||"")};
  const sv2=(id,pi)=>{onSave(id,pi,Number(ev)||0);setEc(null)};
  return (
    <div className="space-y-4"><div className="flex items-center justify-between"><h2 className="text-base font-bold">Payment Tracking</h2><p className="text-[10px] text-slate-500">Click cell to edit Â· $2/draw</p></div>
    <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl overflow-hidden"><div className="overflow-x-auto"><table className="w-full text-xs"><thead><tr className="border-b border-slate-800/60">
      <th className="text-left px-3 py-2 text-slate-400 uppercase sticky left-0 bg-slate-900/95 z-10 min-w-[100px]">Member</th>
      {pStats.map((p,i)=><th key={i} className="text-center px-2 py-2 text-slate-400 uppercase whitespace-nowrap"><div>{p.l}</div><div className="text-[9px] font-normal text-slate-500">{fmtS(p.s)}</div><div className={`text-[8px] font-normal ${p.w===4?"text-violet-400":"text-sky-400"}`}>{p.w}wk Â· ${p.cost}</div></th>)}
      <th className="text-center px-2 py-2 text-slate-400 uppercase">Paid</th><th className="text-center px-2 py-2 text-slate-400 uppercase">Owed</th><th className="text-center px-2 py-2 text-slate-400 uppercase">Bal</th>
    </tr></thead><tbody>{members.map(m=>{
      let tp=0,to=0;pStats.forEach((p,i)=>{if(isAct(m,p.s))to+=p.cost;tp+=(payments[m.id]?.[i]||0)});const bal=tp-to;
      return <tr key={m.id} className={`border-b border-slate-800/30 ${m.exit?"opacity-40":""}`}>
        <td className="px-3 py-1.5 text-slate-300 font-medium sticky left-0 bg-slate-900/95 z-10"><span className="inline-flex items-center gap-1.5"><span className="w-4 h-4 rounded text-[9px] flex items-center justify-center font-bold bg-slate-800 text-slate-400">{m.id}</span>{m.name.split(",")[0].split(" and ")[0]}</span></td>
        {pStats.map((p,i)=>{const act=isAct(m,p.s);const paid=payments[m.id]?.[i]||0;const k=`${m.id}-${i}`;const isEd=ec===k;const ok=paid>=p.cost;
        return <td key={i} className="text-center px-1 py-1">{!act?<span className="text-[10px] text-slate-700">â€”</span>:isEd?<input autoFocus type="number" value={ev} onChange={e=>setEv(e.target.value)} onBlur={()=>sv2(m.id,i)} onKeyDown={e=>{if(e.key==="Enter")sv2(m.id,i);if(e.key==="Escape")setEc(null)}} className="w-12 bg-slate-800 border border-sky-500 rounded px-1 py-0.5 text-[10px] text-white text-center font-mono"/>:
        <button onClick={()=>se(m.id,i,paid)} className={`text-[10px] font-mono px-1.5 py-0.5 rounded cursor-pointer ${paid>0?(ok?"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20":"bg-amber-500/10 text-amber-400 hover:bg-amber-500/20"):"text-slate-600 hover:bg-slate-800"}`}>{paid>0?`$${paid}`:"â€”"}</button>}</td>})}
        <td className="text-center px-2 py-1.5 text-[10px] font-mono text-slate-300">${tp}</td><td className="text-center px-2 py-1.5 text-[10px] font-mono text-slate-400">${to}</td>
        <td className={`text-center px-2 py-1.5 text-[10px] font-mono font-bold ${bal>=0?"text-emerald-400":"text-rose-400"}`}>{bal>=0?"+":""}{bal}</td>
      </tr>})}</tbody></table></div></div></div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PERIOD SUMMARY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function PeriodSummaryModal({members,pStats,mWin,payments,isAdmin,onClose}){
  const[copied,setCopied]=useState(false);
  const today=new Date().toISOString().slice(0,10);
  const curP=pStats.find((p,i)=>{const nx=pStats[i+1]?.s||"9999-12-31";return today>=p.s&&today<nx})||pStats[pStats.length-1];
  const completedDraws=curP.draws.filter(d=>!isEmpty(d));
  const remainingCount=curP.dpp-completedDraws.length;
  const pendingDraws=curP.draws.filter(d=>isEmpty(d));
  const actMs=members.filter(m=>isAct(m,curP.s));

  const lines=[];
  lines.push("ğŸ± LOTTO SYNDICATE â€” " + curP.l.toUpperCase() + " UPDATE");
  lines.push("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  lines.push("");
  lines.push("ğŸ“… Period: " + fmt(curP.s) + " â€” " + curP.w + " weeks (" + curP.dpp + " draws)");
  lines.push("âœ… Draws completed: " + completedDraws.length + " of " + curP.dpp);
  lines.push("â³ Draws remaining: " + remainingCount);
  if(pendingDraws.length>0){
    lines.push("   Next: " + pendingDraws.slice(0,3).map(d=>fmtS(d.date)).join(", "));
  }
  lines.push("");
  lines.push("ğŸ’° PERIOD WINNINGS: $" + curP.tp);
  if(curP.tp>0){
    const winDraws=curP.draws.filter(d=>d.prize>0);
    winDraws.forEach(d=>{lines.push("   Draw #" + d.num + " (" + fmtS(d.date) + "): $" + d.prize)});
  }
  lines.push("ğŸ‘¥ Active members: " + curP.ac);
  lines.push("ğŸ’µ Per member earnings: $" + curP.pm.toFixed(2));
  lines.push("");
  lines.push("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

  if(remainingCount<=2){
    const nextP=pStats.find(p=>p.s>curP.s);
    if(nextP){
      lines.push("");
      lines.push("ğŸ”” NEXT PERIOD: " + nextP.l);
      lines.push("ğŸ“… Starts: " + fmt(nextP.s));
      lines.push("ğŸ’² Subscription: $" + nextP.cost + " (" + nextP.dpp + " draws Ã— $2)");
      lines.push("");
      lines.push("Please send your $" + nextP.cost + " subscription for " + nextP.l + ".");
    }
  }

  if(isAdmin && Object.keys(payments).length>0){
    const balances=[];
    actMs.forEach(m=>{
      let tp=0,to=0;
      pStats.forEach((p,i)=>{if(isAct(m,p.s))to+=p.cost;tp+=(payments[m.id]?.[i]||0)});
      const bal=tp-to;
      const earn=mWin[m.id]||0;
      if(bal<0) balances.push({name:m.name.split(",")[0].split(" and ")[0],bal,owed:Math.abs(bal)});
    });
    if(balances.length>0){
      lines.push("");
      lines.push("âš ï¸ OUTSTANDING BALANCES:");
      balances.forEach(b=>{lines.push("   " + b.name + ": -$" + b.owed)});
    }
  }

  lines.push("");
  lines.push("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  lines.push("ğŸ“Š ALL-TIME STATS");
  const totalDraws=pStats.reduce((s,p)=>s+p.draws.filter(d=>!isEmpty(d)).length,0);
  const totalWon=pStats.reduce((s,p)=>s+p.tp,0);
  lines.push("   Total draws: " + totalDraws);
  lines.push("   Total won: $" + totalWon);
  lines.push("   Win rate: " + (totalDraws>0?((pStats.reduce((s,p)=>s+p.draws.filter(d=>d.prize>0).length,0)/totalDraws)*100).toFixed(0):0) + "%");

  const summary=lines.join("\n");
  const doCopy=()=>{navigator.clipboard.writeText(summary).then(()=>{setCopied(true);setTimeout(()=>setCopied(false),2000)}).catch(()=>{})};

  return (<Modal title="Period Summary" onClose={onClose}><div className="space-y-4">
    <div className="flex items-center gap-2 mb-2">
      <span className={`text-[10px] px-2 py-1 rounded-full ${remainingCount<=2?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"bg-sky-500/20 text-sky-300 border border-sky-500/30"}`}>
        {remainingCount<=2?"â° "+remainingCount+" draws left â€” time to collect!":"ğŸ“‹ "+remainingCount+" draws remaining"}
      </span>
    </div>
    <pre className="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-xs text-slate-300 whitespace-pre-wrap font-mono leading-relaxed max-h-80 overflow-y-auto">{summary}</pre>
    <div className="flex gap-2">
      <button onClick={onClose} className="flex-1 px-4 py-2.5 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">Close</button>
      <button onClick={doCopy} className={`flex-1 px-4 py-2.5 rounded-xl text-sm font-medium flex items-center justify-center gap-1.5 transition-colors ${copied?"bg-emerald-600 text-white":"bg-amber-600 hover:bg-amber-500 text-white"}`}>
        <Ic n={copied?"tr":"copy"} s={14}/>{copied?"Copied!":"Copy to Clipboard"}
      </button>
    </div>
  </div></Modal>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHARTS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ChartsTab({members,actM,completedDraws,draws,pStats,mWin}){
  const barRef=React.useRef(null);
  const lineRef=React.useRef(null);
  const barChart=React.useRef(null);
  const lineChart=React.useRef(null);

  useEffect(()=>{
    if(!barRef.current||typeof Chart==='undefined')return;
    if(barChart.current)barChart.current.destroy();
    const activeMembers=members.filter(m=>!m.exit).sort((a,b)=>(mWin[b.id]||0)-(mWin[a.id]||0));
    const labels=activeMembers.map(m=>m.id+" â€” "+m.name.split(",")[0].split(" and ")[0]);
    const winData=activeMembers.map(m=>Number((mWin[m.id]||0).toFixed(2)));
    const winCounts=activeMembers.map(m=>{
      let count=0;
      completedDraws.forEach(dr=>{
        const w=getW(dr);const r=getMatches(m.nums,m.pb,w,dr.pb);
        if(r.m>=3||r.pb)count++;
      });
      return count;
    });
    const maxWin=Math.max(...winData,1);
    barChart.current=new Chart(barRef.current,{
      type:'bar',
      data:{
        labels,
        datasets:[{
          label:'Total Winnings ($)',
          data:winData,
          backgroundColor:winData.map(w=>w>0?'rgba(52,211,153,0.6)':'rgba(100,116,139,0.3)'),
          borderColor:winData.map(w=>w>0?'rgba(52,211,153,0.9)':'rgba(100,116,139,0.5)'),
          borderWidth:1,
          borderRadius:6,
          barPercentage:0.7
        },{
          label:'Winning Draws',
          data:winCounts,
          backgroundColor:'rgba(251,191,36,0.4)',
          borderColor:'rgba(251,191,36,0.8)',
          borderWidth:1,
          borderRadius:6,
          barPercentage:0.7
        }]
      },
      options:{
        responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{color:'#94a3b8',font:{size:11},padding:15}},
          tooltip:{backgroundColor:'#1e293b',titleColor:'#f1f5f9',bodyColor:'#cbd5e1',borderColor:'#334155',borderWidth:1}},
        scales:{
          x:{ticks:{color:'#64748b',font:{size:10}},grid:{color:'rgba(51,65,85,0.3)'}},
          y:{beginAtZero:true,ticks:{color:'#64748b',font:{size:10},callback:v=>'$'+v},grid:{color:'rgba(51,65,85,0.3)'}}
        }
      }
    });
  },[members,mWin,completedDraws]);

  useEffect(()=>{
    if(!lineRef.current||typeof Chart==='undefined')return;
    if(lineChart.current)lineChart.current.destroy();
    const sorted=[...completedDraws].sort((a,b)=>a.date.localeCompare(b.date));
    if(sorted.length===0)return;
    let cumInvested=0,cumWon=0;
    const labels=[];const investedData=[];const wonData=[];
    sorted.forEach(dr=>{
      const active=members.filter(m=>isAct(m,dr.date)).length;
      cumInvested+=active*2;
      cumWon+=(dr.prize||0);
      labels.push(fmtS(dr.date));
      investedData.push(cumInvested);
      wonData.push(cumWon);
    });
    lineChart.current=new Chart(lineRef.current,{
      type:'line',
      data:{
        labels,
        datasets:[{
          label:'Total Invested',
          data:investedData,
          borderColor:'rgba(244,63,94,0.8)',
          backgroundColor:'rgba(244,63,94,0.1)',
          fill:true,tension:0.3,pointRadius:0,pointHitRadius:8,borderWidth:2
        },{
          label:'Total Won',
          data:wonData,
          borderColor:'rgba(52,211,153,0.8)',
          backgroundColor:'rgba(52,211,153,0.1)',
          fill:true,tension:0.3,pointRadius:0,pointHitRadius:8,borderWidth:2
        }]
      },
      options:{
        responsive:true,maintainAspectRatio:false,
        interaction:{mode:'index',intersect:false},
        plugins:{legend:{position:'top',labels:{color:'#94a3b8',font:{size:11},padding:15}},
          tooltip:{backgroundColor:'#1e293b',titleColor:'#f1f5f9',bodyColor:'#cbd5e1',borderColor:'#334155',borderWidth:1,
            callbacks:{label:ctx=>ctx.dataset.label+': $'+ctx.parsed.y}}},
        scales:{
          x:{ticks:{color:'#64748b',font:{size:9},maxTicksLimit:15},grid:{color:'rgba(51,65,85,0.2)'}},
          y:{beginAtZero:true,ticks:{color:'#64748b',font:{size:10},callback:v=>'$'+v},grid:{color:'rgba(51,65,85,0.3)'}}
        }
      }
    });
  },[completedDraws,members]);

  useEffect(()=>{return()=>{if(barChart.current)barChart.current.destroy();if(lineChart.current)lineChart.current.destroy()}},[]);

  const totalInvested=completedDraws.reduce((s,dr)=>{const a=members.filter(m=>isAct(m,dr.date)).length;return s+a*2},0);
  const totalWon=completedDraws.reduce((s,d)=>s+(d.prize||0),0);
  const roi=totalInvested>0?((totalWon/totalInvested)*100).toFixed(1):0;

  return (
    <div className="space-y-5">
      <h2 className="text-base font-bold flex items-center gap-2"><Ic n="chart" s={18}/> Charts & Statistics</h2>
      <div className="grid grid-cols-3 gap-3">
        <St l="Total Invested" v={`$${totalInvested}`} s={`${completedDraws.length} draws Ã— ${actM.length} members`} c="rose"/>
        <St l="Total Won" v={`$${totalWon}`} s={`${completedDraws.filter(d=>d.prize>0).length} winning draws`} c="emerald"/>
        <St l="Return" v={`${roi}%`} s={totalWon>totalInvested?"In profit!":"Keep playing!"} c="amber"/>
      </div>
      <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl p-5">
        <h3 className="text-sm font-semibold text-white mb-4 flex items-center gap-2"><Ic n="tr" s={15}/> Member Winnings & Win Count</h3>
        <div style={{height:"320px"}}><canvas ref={barRef}></canvas></div>
      </div>
      <div className="bg-slate-900/50 border border-slate-800/50 rounded-2xl p-5">
        <h3 className="text-sm font-semibold text-white mb-4 flex items-center gap-2"><Ic n="mon" s={15}/> Cumulative Investment vs Winnings</h3>
        <div style={{height:"320px"}}><canvas ref={lineRef}></canvas></div>
        <div className="flex items-center justify-center gap-6 mt-3 text-[10px] text-slate-500">
          <span>Gap = ${totalInvested-totalWon} net cost</span>
          <span>Â·</span>
          <span>Over {completedDraws.length} draws since {fmt(completedDraws.length>0?[...completedDraws].sort((a,b)=>a.date.localeCompare(b.date))[0].date:"")}</span>
        </div>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function Modal({title,children,onClose}){return (
  <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" onClick={onClose}>
    <div className="bg-slate-900 border border-slate-800 rounded-2xl p-5 w-full max-w-lg shadow-2xl max-h-[90vh] overflow-y-auto" onClick={e=>e.stopPropagation()}>
      <div className="flex items-center justify-between mb-4"><h3 className="text-base font-bold text-white">{title}</h3><button onClick={onClose} className="p-1 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white"><Ic n="x" s={16}/></button></div>{children}
    </div></div>
)}

function AddPeriodModal({periods,onClose,onAdd}){
  const sorted=[...periods].sort((a,b)=>a.s.localeCompare(b.s));const last=sorted[sorted.length-1];
  const lastStart=new Date(last.s+"T12:00:00");const newStart=new Date(lastStart);newStart.setDate(newStart.getDate()+last.w*7);
  const newStartStr=newStart.toISOString().slice(0,10);const newNum=sorted.length+1;
  const previewDates=[];const end=new Date(newStart);end.setDate(end.getDate()+28);const cur=new Date(newStart);
  while(cur<end){if([1,3,6].includes(cur.getDay()))previewDates.push(new Date(cur));cur.setDate(cur.getDate()+1)}
  const dayName=d=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];
  return (<Modal title="Add New Period" onClose={onClose}><div className="space-y-4">
    <div className="bg-slate-800/50 rounded-xl p-4">
      {[["New Period",`Period ${newNum}`],["Start Date",fmt(newStartStr)],["Cycle","4 weeks"],["Draws","12 (Mon/Wed/Sat)"],["Cost/Member","$24 (12 Ã— $2)"]].map(([l,v])=><div key={l} className="flex items-center justify-between mb-1.5 last:mb-0"><span className="text-xs text-slate-400">{l}</span><span className="text-sm text-white">{v}</span></div>)}
    </div>
    <div><h4 className="text-[10px] text-slate-400 uppercase tracking-wider mb-2">Draw Dates</h4><div className="grid grid-cols-3 gap-1.5">{previewDates.map((d,i)=><div key={i} className="bg-slate-800/40 rounded-lg px-2 py-1.5 text-center"><span className="text-[10px] text-slate-500">{dayName(d)}</span><span className="text-xs text-slate-300 ml-1">{d.toLocaleDateString("en-US",{month:"short",day:"numeric"})}</span></div>)}</div></div>
    <div className="flex gap-2 pt-1"><button onClick={onClose} className="flex-1 px-4 py-2.5 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">Cancel</button><button onClick={onAdd} className="flex-1 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-sm text-white font-medium">Create Period</button></div>
  </div></Modal>);
}

function MemModal({onClose,onSave,member}){
  const[f,setF]=useState(member||{name:"",join:"",exit:null,nums:["","","","",""],pb:"",qp:false});
  const u=(k,v)=>setF(p=>({...p,[k]:v}));
  const ok=()=>{const ns=(Array.isArray(f.nums)?f.nums:[]).map(Number).filter(n=>n>0);if(!f.name||ns.length!==5||!f.pb||!f.join)return;onSave({...f,nums:ns,pb:Number(f.pb),exit:f.exit||null})};
  return (<Modal title={member?"Edit Member":"Add Member"} onClose={onClose}><div className="space-y-3">
    <div className="grid grid-cols-2 gap-3">
      <div className="col-span-2"><label className="block text-[10px] text-slate-400 mb-1 uppercase">Name</label><input value={f.name} onChange={e=>u("name",e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white"/></div>
      <div><label className="block text-[10px] text-slate-400 mb-1 uppercase">Join Date</label><input type="date" value={f.join} onChange={e=>u("join",e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white"/></div>
      <div><label className="block text-[10px] text-slate-400 mb-1 uppercase">Exit Date</label><input type="date" value={f.exit||""} onChange={e=>u("exit",e.target.value||null)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white"/></div></div>
    <div><label className="block text-[10px] text-slate-400 mb-1 uppercase">Numbers (5)</label><div className="flex gap-2">{[0,1,2,3,4].map(i=><input key={i} type="number" min="1" max="69" value={Array.isArray(f.nums)?f.nums[i]||"":""} onChange={e=>{const a=Array.isArray(f.nums)?[...f.nums]:["","","","",""];a[i]=e.target.value;u("nums",a)}} className="w-14 bg-slate-800 border border-slate-700 rounded-lg px-2 py-2 text-sm text-white text-center font-mono"/>)}</div></div>
    <div className="flex gap-3 items-end"><div className="w-20"><label className="block text-[10px] text-slate-400 mb-1 uppercase">PB</label><input type="number" min="1" max="26" value={f.pb} onChange={e=>u("pb",e.target.value)} className="w-full bg-slate-800 border border-rose-500/30 rounded-lg px-2 py-2 text-sm text-rose-300 font-mono text-center"/></div>
    <label className="flex items-center gap-1.5 text-xs text-slate-300 cursor-pointer pb-2"><input type="checkbox" checked={f.qp||false} onChange={e=>u("qp",e.target.checked)} className="rounded bg-slate-800 border-slate-600"/>Quick Pick</label></div>
    <div className="flex gap-2 pt-2"><button onClick={onClose} className="flex-1 px-4 py-2 border border-slate-700 rounded-xl text-sm text-slate-300 hover:bg-slate-800">Cancel</button><button onClick={ok} className="flex-1 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-xl text-sm text-white font-medium">Save</button></div>
  </div></Modal>);
}

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
